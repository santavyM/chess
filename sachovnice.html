
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hra proti AI</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://use.typekit.net/iwp0qte.css">
    <script defer src="script.js"></script>
    <link rel="stylesheet" href="assets/css/chessboard-1.0.0.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="assets/js/chessboard-1.0.0.min.js"></script>


</head>
<body>

    <header class="navbar">
        <!-- NAVIGACE (SKRYT√Å NA MOBILU) -->
        <nav class="left-nav">
            <a href="/"><img src="assets/home.png" alt="Home"></a>
            <a href="#">Ve≈ôejn√© partie</a>
            <a href="#">Turnaje</a>
            <a href="#">F√≥rum</a>
            <a href="#">ELO</a>
        </nav>
    
        <!-- LOGO (VIDITELN√â V≈ΩDY) -->
        <div class="logo desktop">Chessgame<span class="square"></span></div>
         <!-- LOGO + HAMBURGER MENU -->
            <div class="logo-container">
                <div class="logo">Chessgame<span class="square"></span></div>

                <!-- HAMBURGER MENU -->
                <div class="hamburger-menu" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        <!-- U≈ΩIVATELSK√â AKCE (SKRYT√â NA MOBILU) -->
        <div class="user-actions">
            <a href="#"><img src="assets/user.png" alt="User"></a>
            <a href="#">P≈ôihl√°≈°en√≠</a>
            <a href="#"><img src="assets/notification.png" alt="Notifications"></a>
            <a href="/sachovnice.html"><button class="btn-nav"><span class="plus">+</span> Nov√° hra</button></a>
        </div>    
        <!-- MOBILN√ç MENU (SKRYT√â V√ùCHOZ√ç STAV) -->
        <div class="mobile-menu">
            <div class="user-actions">
                <button class="btn-nav"><span class="plus">+</span> Nov√° hra</button>
                <button class="close-menu" onclick="toggleMenu()">‚úï</button>
            </div>
    
            <div class="user-actions">
                <a href="#"><img src="assets/user.png" alt="User"></a>
                <a href="#">P≈ôihl√°≈°en√≠</a>
                <a href="#"><img src="assets/notification.png" alt="Notifications"></a><br>
            </div>
    
            <nav class="left-nav">
                <a href="#">Ve≈ôejn√© partie</a>
                <a href="#">Turnaje</a>
                <a href="#">F√≥rum</a>
                <a href="#">ELO</a>
            </nav>
        </div>
    </header>
    
    
    <main>
        <div class="game-container">
            <!-- Historie tah≈Ø -->
            <aside class="history">
                <h3>Tahy</h3>
                
                
            
                <ul id="move-history">
                    <li><span>1</span> <span>‚ôú D2 - D4</span> <span>D7 - D6</span></li>
                    <li><span>2</span> <span>D2 - D4</span> <span>‚ôü D7 - D6</span></li>
                    <li><span>3</span> <span>D2 - D4</span> <span>D7 - D6</span></li>
                </ul>
            </aside>

    
            <!-- ≈†achovnice uprost≈ôed -->
            <section class="board-container">
                <div id="board" style="max-width: 600px"></div>
                <button class="btn-primary" onclick="resetGame()">Restart hry</button>
            </section>
    
            <!-- Chat -->
            <aside class="chat">
                <h3>Chat</h3>
                <div class="messages">
                    <p>What is faster? Touch screen or mouse movements?</p>
                    <p>I don‚Äôt know. Let me guess - I think maybe mouse?</p>
                    <p>No way...</p>
                    <p class="highlight">Hahaha</p>
                </div>
                <input type="text" placeholder="I can write some words here...">
                <button>‚û§</button>
            </aside>
        </div>

    
        <div class="clock">
            <div class="clock-content">
                <div class="clock-info">
                    <div class="time">14:40</div>
                    <div class="date">sobota<br>8. 2. 2025</div>
                    <div class="nameday">ƒåestm√≠r</div>
                </div>
                <div class="analog-clock">
                    <div class="dial"></div>
                    <div class="hand hour-hand"></div>
                    <div class="hand minute-hand"></div>
                    <div class="hand second-hand"></div>
                    <div class="center-dot"></div>
                </div>
            </div>
        </div>
        
            <footer class="footer">
                <div class="copyright">¬© 2008-2023 Studio 9 s.r.o.</div>
            </footer>
        </main>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
    console.log("Inicializace ≈°achovnice...");

    board = Chessboard('board', {
        draggable: true,
        position: 'start',
        onDrop: handleMove
    });

    console.log("Board inicializov√°n:", board);
});

// ‚úÖ Funkce pro zpracov√°n√≠ hr√°ƒçova tahu
function handleMove(source, target) {
    var move = source + target;
    console.log("Tah hr√°ƒçe:", move);

    let prevFen = board.fen(); // üî• Ulo≈æ√≠me stav p≈ôed tahem

    fetch("http://127.0.0.1:8000/move", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ move: move })
    })
    .then(response => response.json())
    .then(data => {
        console.log("Tah hr√°ƒçe:", move);
        console.log("AI odpovƒõƒè:", data.ai_move || "≈Ω√°dn√Ω tah AI");

        if (data.error) {
            alert("‚ùå Neplatn√Ω tah!");
            board.position(prevFen); // üî• Okam≈æitƒõ vr√°t√≠me p≈ôedchoz√≠ pozici
            return;
        }

        // ‚úÖ Aktualizujeme pozici ≈°achovnice podle nov√©ho FEN
        board.position(data.fen);

        // ‚úÖ P≈ôid√°me tahy do historie ve spr√°vn√©m form√°tu
        updateMoveHistory(formatMove(data.player_move), formatMove(data.ai_move));
    })
    .catch(error => {
        console.error("‚ùå Chyba:", error);
        board.position(prevFen); // üî• Pokud sel≈æe server, vr√°t√≠me pozici zpƒõt
    });
}

// ‚úÖ Funkce pro form√°tov√°n√≠ tahu (e2e3 ‚Üí E2-E3)
function formatMove(move) {
    if (!move) return null; // Pokud AI nem√° tah, vr√°t√≠me null
    return move.slice(0, 2).toUpperCase() + "-" + move.slice(2, 4).toUpperCase();
}

// ‚úÖ Funkce pro aktualizaci historie tah≈Ø
function updateMoveHistory(playerMove, aiMove) {
    const moveHistory = document.getElementById("move-history");

    let moveNumber = Math.floor(moveHistory.children.length / 2) + 1; // Poƒçet tah≈Ø

    let playerMoveHTML = `<li><span>${moveNumber}.</span> <span>J√°</span> <span>${playerMove}</span></li>`;
    let aiMoveHTML = aiMove ? `<li><span>${moveNumber}.</span> <span>AI</span> <span>${aiMove}</span></li>` : "";

    moveHistory.innerHTML += playerMoveHTML + aiMoveHTML; // P≈ôid√°n√≠ do historie
}

// ‚úÖ Funkce pro reset hry
async function resetGame() {
    try {
        const response = await fetch("http://127.0.0.1:8000/reset", { method: "POST" });
        const data = await response.json();
        console.log("‚ôªÔ∏è Restart hry:", data.message);
        alert(data.message);

        // ‚úÖ Resetujeme ≈°achovnici na startovn√≠ pozici
        board.position('start');

        // ‚úÖ Vyƒçist√≠me historii tah≈Ø
        document.getElementById("move-history").innerHTML = "";
    } catch (error) {
        console.error("‚ùå Chyba p≈ôi restartu hry:", error);
    }
}

        </script>
</body>
</html>